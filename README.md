# EPH (Emergent Perceptual Haze) ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

è‡ªç”±ã‚¨ãƒãƒ«ã‚®ãƒ¼åŸç†ï¼ˆFree Energy Principleï¼‰ã«åŸºã¥ãã€æ··é›‘ç’°å¢ƒã«ãŠã‘ã‚‹ç¤¾ä¼šçš„ãƒ­ãƒœãƒƒãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ç ”ç©¶å®Ÿè£…ã§ã™ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**EPHï¼ˆEmergent Perceptual Hazeï¼‰** ã¯ã€ä¸ç¢ºå®Ÿæ€§ã‚’**çŸ¥è¦šè§£åƒåº¦ï¼ˆPerceptual Precisionï¼‰**ã®å¯å¤‰è¨­è¨ˆã¨ã—ã¦æ‰±ã†Active Inferenceã®å·¥å­¦çš„æ‹¡å¼µã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã™ã€‚äºˆæ¸¬ä¿¡é ¼æ€§ã«å¿œã˜ã¦çŸ¥è¦šãƒ»æ³¨æ„ã®é‹­ã•ã‚’é€£ç¶šçš„ã«å¤‰èª¿ã™ã‚‹ã“ã¨ã§ã€å˜ä½“ãƒ­ãƒœãƒƒãƒˆãŠã‚ˆã³ç¾¤çŸ¥èƒ½ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹åœæ­¢ï¼ˆFreezingï¼‰ãƒ»æŒ¯å‹•ãƒ»åˆ†æ–­ã¨ã„ã£ãŸä¸ç¢ºå®Ÿæ€§èµ·å› ã®è¡Œå‹•ç ´ç¶»ã‚’æ§‹é€ çš„ã«æŠ‘åˆ¶ã—ã¾ã™ã€‚

### ä¸»è¦æ¦‚å¿µ
- **SPM (Saliency Polar Map)**: éœŠé•·é¡V1é‡ã‚’æ¨¡å€£ã—ãŸå¯¾æ•°æ¥µåº§æ¨™ã®ç”Ÿä½“æ¨¡å€£çš„çŸ¥è¦šè¡¨ç¾
- **Haze**: ä¸ç¢ºå®Ÿæ€§ã‚’å®šé‡åŒ–ã—ã€çŸ¥è¦šè§£åƒåº¦ã®åˆ¶å¾¡ã«å†™åƒã™ã‚‹æ“ä½œçš„æŒ‡æ¨™ $H(y,u)$
- **Pattern D Integration**: è¡Œå‹•ä¾å­˜ã®ä¸ç¢ºå®Ÿæ€§ï¼ˆCounterfactual Hazeï¼‰ã‚’æ¨å®šã™ã‚‹VAEãƒ¢ãƒ‡ãƒ«
- **4ç¾¤ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«äº¤å·®**: æ¨™æº–çš„ãªãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªï¼ˆN/S/E/Wç¾¤ãŒä¸­å¤®ã§äº¤å·®ï¼‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
crlEPH-dlc/
â”œâ”€â”€ doc/                          # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ç ”ç©¶ææ¡ˆæ›¸
â”œâ”€â”€ src/                          # Juliaãƒ¡ã‚¤ãƒ³å®Ÿè£…
â”‚   â”œâ”€â”€ config.jl                 # ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
â”‚   â”œâ”€â”€ spm.jl                    # SPMç”Ÿæˆï¼ˆ12Ã—12Ã—3ch: å æœ‰ãƒ»é¡•è‘—æ€§ãƒ»ãƒªã‚¹ã‚¯ï¼‰
â”‚   â”œâ”€â”€ scenarios.jl              # ã‚·ãƒŠãƒªã‚ªå®šç¾©ï¼ˆScramble/Corridor/Random Obstaclesï¼‰
â”‚   â”œâ”€â”€ dynamics.jl               # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç‰©ç†æ¼”ç®—
â”‚   â”œâ”€â”€ controller.jl             # FEPãƒ™ãƒ¼ã‚¹ + Random walkã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ï¼ˆv6.3ï¼‰
â”‚   â”œâ”€â”€ action_vae.jl             # Action-Dependent VAE (Pattern D)
â”‚   â”œâ”€â”€ communication.jl          # ZMQé€šä¿¡
â”‚   â”œâ”€â”€ metrics.jl                # è©•ä¾¡æŒ‡æ¨™ãƒ»Freezingåˆ¤å®š
â”‚   â””â”€â”€ logger.jl                 # HDF5ãƒ­ã‚®ãƒ³ã‚°
â”œâ”€â”€ scripts/                      # å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ run_all.sh                # [æ¨å¥¨] ä¸€æ‹¬èµ·å‹•ãƒ©ãƒ³ãƒãƒ£ãƒ¼
â”‚   â”œâ”€â”€ run_simulation.jl         # ãƒ¡ã‚¤ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ create_dataset_v63_random_collision_free.jl  # v6.3ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆScramble/Corridorï¼‰
â”‚   â”œâ”€â”€ create_dataset_v63_random_obstacles.jl       # v6.3ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆRandom Obstaclesï¼‰
â”‚   â”œâ”€â”€ train_action_vae_v62.jl   # VAEå­¦ç¿’ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆv6.2/v6.3å¯¾å¿œï¼‰
â”‚   â”œâ”€â”€ test_obstacles_random.jl  # Random Obstaclesæ¤œè¨¼
â”‚   â””â”€â”€ archive/                  # æ—§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®é€€é¿å ´æ‰€
â”œâ”€â”€ viewer/                       # Pythonå¯è¦–åŒ–
â”‚   â”œâ”€â”€ raw_v63_viewer.py         # [NEW] ç”Ÿè»Œè·¡ãƒ‡ãƒ¼ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆSPMå†æ§‹æˆï¼‰
â”‚   â”œâ”€â”€ spm_reconstructor.py      # [NEW] Python SPMç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ raw_v62_viewer.py         # v6.2ãƒ‡ãƒ¼ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚¢
â”‚   â”œâ”€â”€ zmq_client.py             # ZMQã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒ
â”‚   â”œâ”€â”€ main_viewer.py            # 4ç¾¤è¡¨ç¤º
â”‚   â””â”€â”€ detail_viewer.py          # SPMè©³ç´°ãƒ“ãƒ¥ãƒ¼
â”œâ”€â”€ Project.toml                  # Juliaä¾å­˜é–¢ä¿‚
â”œâ”€â”€ requirements.txt              # Pythonä¾å­˜é–¢ä¿‚
â””â”€â”€ CLAUDE.md                     # Claude Codeå‘ã‘é–‹ç™ºã‚¬ã‚¤ãƒ‰
```

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨ï¼‰**:
```bash
./scripts/setup.sh
```
ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè‡ªå‹•çš„ã« Julia ã¨ Python ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼ˆåˆå›ã¯5-10åˆ†ï¼‰ã€‚

**æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**:
```bash
# Julia (1.10+)
julia --project=. -e 'using Pkg; Pkg.instantiate()'

# Python (3.10+)
~/local/venv/bin/pip install -r requirements.txt
```

è©³ç´°ã¯ [SETUP.md](SETUP.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### 2. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

**æ¨å¥¨: ä¸€æ‹¬èµ·å‹• (Mac/Linux)**
```bash
./scripts/run_all.sh
```
ã“ã‚Œã«ã‚ˆã‚Šã€Juliaãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨Pythonãƒ“ãƒ¥ãƒ¼ã‚¢ãŒèµ·å‹•ã—ã¾ã™ã€‚

**æ‰‹å‹•èµ·å‹•**
```bash
# Terminal 1: Simulation
julia --project=. scripts/run_simulation.jl

# Terminal 2: Viewer
~/local/venv/bin/python viewer/detail_viewer.py
```

### 3. ãƒ‡ãƒ¼ã‚¿åé›†ã¨å¯è¦–åŒ– (v6.3)

**v6.3 ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆController-Bias-Freeï¼‰**
```bash
# Scramble + Corridor ã‚·ãƒŠãƒªã‚ª
julia --project=. scripts/create_dataset_v63_random_collision_free.jl \
  --scenario both --densities 10 --seeds 1,2,3 --steps 1500

# Random Obstacles ã‚·ãƒŠãƒªã‚ª
julia --project=. scripts/create_dataset_v63_random_obstacles.jl \
  --densities 10 --obstacle-counts 50 --seeds 1,2,3 --steps 1500
```

**ç”Ÿè»Œè·¡ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–**
```bash
# Raw trajectory viewer (SPM reconstruction)
~/local/venv/bin/python viewer/raw_v63_viewer.py \
  data/vae_training/raw_v63/v63_scramble_d10_s1_*.h5
```

### 4. VAEå­¦ç¿’

**å­¦ç¿’ï¼ˆv6.2/v6.3ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰**
```bash
julia --project=. scripts/train_action_vae_v62.jl
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (v6.3 Current)

### v6.3ã®ä¸»è¦é©æ–°

**Controller-Bias-Free Data Collection**:
- ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ + å¹¾ä½•å­¦çš„è¡çªå›é¿
- FEPã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®äº‹å‰ãƒã‚¤ã‚¢ã‚¹ã‚’æ’é™¤
- å¤šæ§˜ãªçŠ¶æ…‹-è¡Œå‹•ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å®Ÿç¾

**3ã¤ã®ã‚·ãƒŠãƒªã‚ª**:
1. **Scramble Crossing**: 4ç¾¤ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«äº¤å·®ï¼ˆ40ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰
2. **Corridor**: ç‹­é€šè·¯ã§ã®å¯¾é¢æµå‹•ï¼ˆ20ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€å¹…10mï¼‰
3. **Random Obstacles**: ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ã®å††å½¢éšœå®³ç‰©ç’°å¢ƒï¼ˆ40ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€50éšœå®³ç‰©ï¼‰

**Raw Trajectory Architecture**:
- SPMã‚’ä¿å­˜ã›ãšã€ç”Ÿè»Œè·¡ãƒ‡ãƒ¼ã‚¿ï¼ˆpos, vel, u, headingï¼‰ã®ã¿ä¿å­˜
- å­¦ç¿’æ™‚ã«ã‚ªãƒ³ã‚¶ãƒ•ãƒ©ã‚¤ã§SPMå†æ§‹æˆ
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åŠ¹ç‡: 100å€å‰Šæ¸›ï¼ˆ2GB â†’ 20MB/simulationï¼‰

### ãƒ‡ãƒ¼ã‚¿æ§‹é€  (HDF5)
```
trajectory/
  â”œâ”€â”€ pos        [T, N, 2]  # ä½ç½®
  â”œâ”€â”€ vel        [T, N, 2]  # é€Ÿåº¦
  â”œâ”€â”€ u          [T, N, 2]  # åˆ¶å¾¡å…¥åŠ›
  â”œâ”€â”€ heading    [T, N]     # æ–¹å‘è§’
  â”œâ”€â”€ goal       [N, 2]     # ã‚´ãƒ¼ãƒ«æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«
  â””â”€â”€ d_pref     [T, N, 2]  # å„ªå…ˆæ–¹å‘

obstacles/
  â””â”€â”€ data       [M, 2]     # éšœå®³ç‰©åº§æ¨™

events/
  â”œâ”€â”€ collision       [T, N]  # è¡çªãƒ•ãƒ©ã‚°
  â””â”€â”€ near_collision  [T, N]  # ãƒ‹ã‚¢ãƒŸã‚¹ãƒ•ãƒ©ã‚°
```

## æ©Ÿèƒ½

### v6.3 (å®Œäº†) âœ…
- **Controller-Bias-Free Data**: ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ã«ã‚ˆã‚‹ãƒã‚¤ã‚¢ã‚¹ãƒ•ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿åé›†
- **Random Obstacles**: å†ç¾å¯èƒ½ãªéšœå®³ç‰©ç”Ÿæˆï¼ˆobstacle_seedï¼‰
- **Raw Trajectory Viewer**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ SPMå†æ§‹æˆæ©Ÿèƒ½
- **3ã‚·ãƒŠãƒªã‚ª Ã— 3ã‚·ãƒ¼ãƒ‰**: åˆè¨ˆ9ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆ10MBï¼‰

### ç¾åœ¨ã®ç„¦ç‚¹ ğŸ¯
- **VAEå­¦ç¿’**: v6.3ãƒ‡ãƒ¼ã‚¿ã§ã®å­¦ç¿’å®Ÿé¨“
- **Ablation Study**: v6.2ï¼ˆFEPãƒã‚¤ã‚¢ã‚¹ï¼‰ vs v6.3ï¼ˆãƒã‚¤ã‚¢ã‚¹ãƒ•ãƒªãƒ¼ï¼‰æ¯”è¼ƒ
- **è©•ä¾¡æŒ‡æ¨™**: è¡çªç‡ã€åœæ­¢ç‡ã€è»Œè·¡å¹³æ»‘æ€§ã®å®šé‡è©•ä¾¡

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç ”ç©¶ç›®çš„ã§é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ã€‚

## è‘—è€…

äº”ååµ æ´‹ï¼ˆHiroshi Igarashiï¼‰
æ±äº¬é›»æ©Ÿå¤§å­¦
