# EPH Phase 1-4 å®Œå…¨ã‚¬ã‚¤ãƒ‰

## ç›®æ¬¡
1. [æ¦‚è¦ï¼š4ã¤ã®Phaseã¨ã¯](#æ¦‚è¦)
2. [Phase 1: Scalar Self-Haze](#phase-1)
3. [Phase 2: Environmental Haze](#phase-2)
4. [Phase 3: Advanced Integration](#phase-3)
5. [Phase 4: Full 3D Tensor Haze](#phase-4)
6. [æ¯”è¼ƒè¡¨](#æ¯”è¼ƒè¡¨)
7. [ã©ã¡ã‚‰ã‚’ä½¿ã†ã¹ãã‹](#ã©ã¡ã‚‰ã‚’ä½¿ã†ã¹ãã‹)
8. [è©•ä¾¡æ–¹æ³•](#è©•ä¾¡æ–¹æ³•)

---

## æ¦‚è¦

EPHãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¯**4ã¤ã®å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º**ãŒã‚ã‚Šã¾ã™ï¼š

| Phase | åç§° | ãƒ˜ã‚¤ã‚ºã®æ‰€åœ¨ | è¤‡é›‘åº¦ | ç”¨é€” |
|-------|------|------------|--------|------|
| **Phase 1** | Scalar Self-Haze | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå†…éƒ¨ | â­ ã‚·ãƒ³ãƒ—ãƒ« | åŸºæœ¬å‹•ä½œæ¤œè¨¼ |
| **Phase 2** | Environmental Haze | ç’°å¢ƒã‚°ãƒªãƒƒãƒ‰ | â­â­â­ è¤‡é›‘ | é«˜åº¦ãªç¾¤çŸ¥èƒ½ |
| **Phase 3** | Advanced Integration | Phase 2 + äºˆæ¸¬å™¨ | â­â­â­â­ é«˜åº¦ | äºˆæ¸¬ãƒ™ãƒ¼ã‚¹åˆ¶å¾¡ |
| **Phase 4** | Full 3D Tensor Haze | SPMç©ºé–“ï¼ˆãƒãƒ£ãƒãƒ«æ¯ï¼‰ | â­â­â­â­ é«˜åº¦ | é¸æŠçš„æ³¨æ„ |

**é‡è¦ãªé•ã„ï¼š**
- Phase 1ï¼šã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã€Œè‡ªåˆ†ã®ãƒ˜ã‚¤ã‚ºå€¤ã€ã‚’1ã¤æŒã¤ï¼ˆã‚¹ã‚«ãƒ©ãƒ¼å€¤ï¼‰
- Phase 2ï¼šç’°å¢ƒå…¨ä½“ãŒã€Œãƒ˜ã‚¤ã‚ºã®åœ°å›³ã€ã‚’æŒã¤ï¼ˆ2æ¬¡å…ƒã‚°ãƒªãƒƒãƒ‰ï¼‰
- Phase 3ï¼šPhase 2 + GRUäºˆæ¸¬å™¨ + Shepherdingçµ±åˆ
- Phase 4ï¼š3æ¬¡å…ƒãƒ˜ã‚¤ã‚ºãƒ†ãƒ³ã‚½ãƒ« H(r, Î¸, c) ã§ãƒãƒ£ãƒãƒ«æ¯ã®ç²¾åº¦åˆ¶å¾¡

---

## Phase 1: Scalar Self-Haze

### ğŸ¯ ç›®çš„
**æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªEPHå®Ÿè£…**ã§ã€åŸºæœ¬çš„ãªç¾¤çŸ¥èƒ½ãƒ»å›é¿è¡Œå‹•ã‚’æ¤œè¨¼ã™ã‚‹ã€‚

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```julia
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒ1ã¤ã®ãƒ˜ã‚¤ã‚ºå€¤ã‚’æŒã¤
agent.self_haze::Float64  # ç¯„å›²: [0.0, 1.0]
```

### ğŸ”¬ å‹•ä½œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

#### 1. ãƒ˜ã‚¤ã‚ºè¨ˆç®—ï¼ˆoccupancyãƒ™ãƒ¼ã‚¹ï¼‰
```
å‘¨å›²ã®å æœ‰ç‡Î© â†’ ãƒ˜ã‚¤ã‚ºå€¤ h_self

h_self(Î©) = h_max Â· Ïƒ(-Î±(Î© - Î©_threshold))

where:
  Ïƒ(x) = 1 / (1 + exp(-x))  # Sigmoidé–¢æ•°
  h_max = 0.8                 # æœ€å¤§ãƒ˜ã‚¤ã‚º
  Î± = 10.0                    # æ€¥å³»åº¦
  Î©_threshold = 0.05          # é–¾å€¤
```

**ç›´æ„Ÿçš„ç†è§£ï¼š**
```
å‘¨å›²ã«ç‰©ãŒå°‘ãªã„ï¼ˆÎ©å°ï¼‰â†’ ãƒ˜ã‚¤ã‚ºé«˜ â†’ ç²¾åº¦ä½ â†’ æ¢ç´¢çš„
å‘¨å›²ã«ç‰©ãŒå¤šã„ï¼ˆÎ©å¤§ï¼‰  â†’ ãƒ˜ã‚¤ã‚ºä½ â†’ ç²¾åº¦é«˜ â†’ å›é¿çš„
```

#### 2. ç²¾åº¦å¤‰èª¿ï¼ˆPrecision Modulationï¼‰
```
Î (r,Î¸; h) = Î _base(r,Î¸) Â· (1-h)^Î³

where:
  Î _base: åŸºæº–ç²¾åº¦ï¼ˆè·é›¢æ¸›è¡°é–¢æ•°ï¼‰
  h: ãƒ˜ã‚¤ã‚ºå€¤ [0, 1]
  Î³ = 2.0: ç²¾åº¦å¤‰èª¿ã®å¼·åº¦
```

#### 3. ä¿¡å¿µã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼å¢—åŠ 
```
H[q(s)] âˆ -log(det(Î ))

ãƒ˜ã‚¤ã‚ºé«˜ â†’ Î ä½ â†’ Hé«˜ â†’ ä¸ç¢ºå®Ÿæ€§å¢— â†’ æƒ…å ±æ¢ç´¢è¡Œå‹•
```

### âœ… é•·æ‰€
- **å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«**ï¼š1ã¤ã®ã‚¹ã‚«ãƒ©ãƒ¼å€¤ã®ã¿ç®¡ç†
- **ç†è«–çš„ã«æ˜å¿«**ï¼šActive Inferenceã®åŸºæœ¬æ¦‚å¿µã‚’ç›´æ¥çš„ã«å®Ÿè£…
- **ãƒ‡ãƒãƒƒã‚°å®¹æ˜“**ï¼šãƒ˜ã‚¤ã‚ºå€¤ã‚’ç›´æ¥è¦³å¯Ÿå¯èƒ½
- **è¨ˆç®—ã‚³ã‚¹ãƒˆä½**ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½

### âŒ çŸ­æ‰€
- **ç©ºé–“æƒ…å ±ãªã—**ï¼šã©ã®æ–¹å‘ã«ãƒ˜ã‚¤ã‚ºãŒã‚ã‚‹ã‹ä¸æ˜
- **å±¥æ­´ãªã—**ï¼šéå»ã®çµŒè·¯æƒ…å ±ã‚’ä¿æŒã§ããªã„
- **é€šä¿¡æ©Ÿèƒ½ãªã—**ï¼šä»–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®æƒ…å ±ä¼é”ä¸å¯
- **äºˆæ¸¬ä¸å¯**ï¼šå°†æ¥ã®ãƒ˜ã‚¤ã‚ºçŠ¶æ…‹ã‚’äºˆæ¸¬ã§ããªã„

### ğŸ“ˆ è©•ä¾¡æŒ‡æ¨™
- **å›é¿æˆåŠŸç‡**ï¼šä»–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®è¡çªå›é¿ç‡
- **æ¢ç´¢åŠ¹ç‡**ï¼šç©ºé–“ã®ã‚«ãƒãƒ¼ç‡
- **ãƒ˜ã‚¤ã‚ºé·ç§»**ï¼šisolated â†” crowded ã®åˆ‡ã‚Šæ›¿ãˆé »åº¦
- **è¨ˆç®—æ™‚é–“**ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§èƒ½

### ğŸ§ª å…¸å‹çš„ãªå®Ÿé¨“
```bash
# Phase 1 Validation
./scripts/run_basic_validation.sh 1

# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šä¾‹
EPH_N_AGENTS=10 \
EPH_SIM_TIME=200 \
EPH_WORLD_SIZE=400 \
  julia --project=src_julia scripts/phase1_experiment.jl
```

---

## Phase 2: Environmental Haze

### ğŸ¯ ç›®çš„
**ç’°å¢ƒã‚’ä»‹ã—ãŸé–“æ¥çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆStigmergyï¼‰**ã«ã‚ˆã‚‹é«˜åº¦ãªç¾¤çŸ¥èƒ½ã‚’å®Ÿç¾ã™ã‚‹ã€‚

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```julia
# ç’°å¢ƒãŒ2æ¬¡å…ƒãƒ˜ã‚¤ã‚ºã‚°ãƒªãƒƒãƒ‰ã‚’æŒã¤
env.haze_grid::Matrix{Float64}  # ã‚µã‚¤ã‚º: (width, height)
                                # å„ã‚»ãƒ«ã®ç¯„å›²: [0.0, 1.0]
```

### ğŸ”¬ å‹•ä½œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

#### 1. ãƒ˜ã‚¤ã‚ºå †ç©ï¼ˆHaze Depositionï¼‰
```julia
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç§»å‹•çµŒè·¯ã«ãƒ˜ã‚¤ã‚ºã‚’æ®‹ã™
function deposit_haze_trail(env, agent_pos, deposit_amount=0.2)
    x, y = agent_pos
    env.haze_grid[x, y] += deposit_amount
    env.haze_grid[x, y] = min(env.haze_grid[x, y], 1.0)  # Cap at 1.0
end
```

#### 2. ãƒ˜ã‚¤ã‚ºæ¸›è¡°ï¼ˆTemporal Decayï¼‰
```julia
# æ¯ã‚¹ãƒ†ãƒƒãƒ—ã€å…¨ã‚°ãƒªãƒƒãƒ‰ãŒæ¸›è¡°
env.haze_grid .*= decay_rate  # decay_rate = 0.99
```

**æ™‚é–“ç™ºå±•ï¼š**
```
t=0:   ãƒ˜ã‚¤ã‚ºãªã— [0, 0, 0, 0]
t=1:   å †ç©      [0, 0.2, 0, 0]  (ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒé€šé)
t=2:   æ¸›è¡°      [0, 0.198, 0, 0]
t=3:   æ¸›è¡°      [0, 0.196, 0, 0]
...
```

#### 3. ãƒ˜ã‚¤ã‚ºã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼ˆSPMçµ±åˆï¼‰
```julia
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè‡ªåˆ†ã®SPMå„ãƒ“ãƒ³ã«å¯¾å¿œã™ã‚‹ä½ç½®ã®ãƒ˜ã‚¤ã‚ºã‚’èª­ã¿å–ã‚‹
for r_idx in 1:Nr, Î¸_idx in 1:NÎ¸
    # SPMãƒ“ãƒ³(r,Î¸)ã«å¯¾å¿œã™ã‚‹ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™(x,y)ã‚’è¨ˆç®—
    x, y = spm_bin_to_world_pos(r_idx, Î¸_idx, agent)

    # ç’°å¢ƒã‹ã‚‰ãƒ˜ã‚¤ã‚ºã‚’ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    h_env[r_idx, Î¸_idx] = sample(env.haze_grid, x, y)
end
```

#### 4. ãƒ˜ã‚¤ã‚ºåˆæˆï¼ˆSelf + Environmentï¼‰
```julia
# Total haze = max(self-haze, environmental haze)
H_total(r,Î¸) = max(H_self(r,Î¸), H_env(r,Î¸))
```

### ğŸ§  GRUäºˆæ¸¬å™¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```julia
# éå»ã®SPMã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‹ã‚‰å°†æ¥ã®ãƒ˜ã‚¤ã‚ºã‚’äºˆæ¸¬
h_predicted = GRU_predictor(spm_history)

# äºˆæ¸¬ã‚’è¡Œå‹•é¸æŠã«çµ±åˆ
cost = F_percept(h_current) + Î»_pred * F_percept(h_predicted)
```

### âœ… é•·æ‰€
- **ã‚¹ãƒ†ã‚£ã‚°ãƒãƒ¼ã‚¸ãƒ¼é€šä¿¡**ï¼šç’°å¢ƒã‚’ä»‹ã—ãŸé–“æ¥çš„ãªæƒ…å ±å…±æœ‰
- **çµŒè·¯è¨˜æ†¶**ï¼šéå»ã®ç§»å‹•å±¥æ­´ãŒç’°å¢ƒã«æ®‹ã‚‹
- **æ–¹å‘ä¾å­˜**ï¼šã©ã®æ–¹å‘ã«ãƒ˜ã‚¤ã‚ºãŒå¤šã„ã‹åˆ†ã‹ã‚‹
- **äºˆæ¸¬å¯èƒ½**ï¼šGRUç­‰ã§å°†æ¥ã®ãƒ˜ã‚¤ã‚ºåˆ†å¸ƒã‚’äºˆæ¸¬å¯èƒ½
- **å‰µç™ºçš„ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼šè¤‡é›‘ãªç¾¤ã‚Œè¡Œå‹•ãŒè‡ªç„¶ã«å‡ºç¾

### âŒ çŸ­æ‰€
- **å®Ÿè£…ãŒè¤‡é›‘**ï¼šã‚°ãƒªãƒƒãƒ‰ç®¡ç†ã€ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã€åˆæˆãŒå¿…è¦
- **è¨ˆç®—ã‚³ã‚¹ãƒˆé«˜**ï¼šã‚°ãƒªãƒƒãƒ‰å…¨ä½“ã®æ›´æ–°ãŒå¿…è¦
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¤§**ï¼š(width Ã— height)ã®ã‚°ãƒªãƒƒãƒ‰ä¿æŒ
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•æ„Ÿ**ï¼šdecay_rate, deposit_amountã®èª¿æ•´ãŒé‡è¦

### ğŸ“ˆ è©•ä¾¡æŒ‡æ¨™
- **ãƒ˜ã‚¤ã‚ºåˆ†å¸ƒ**ï¼šç©ºé–“çš„ãªãƒ˜ã‚¤ã‚ºãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¦–è¦šåŒ–
- **çµŒè·¯åŠ¹ç‡**ï¼šé‡è¤‡è¨ªå•ã®å‰Šæ¸›ç‡
- **ç¾¤ã‚Œç¶­æŒæ€§èƒ½**ï¼šã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®å‡é›†æ€§
- **shepherdingæ€§èƒ½**ï¼šç›®æ¨™ä½ç½®ã¸ã®èª˜å°æ™‚é–“
- **äºˆæ¸¬ç²¾åº¦**ï¼šGRUäºˆæ¸¬ vs å®Ÿéš›ã®ãƒ˜ã‚¤ã‚ºã®èª¤å·®

### ğŸ§ª å…¸å‹çš„ãªå®Ÿé¨“
```bash
# Phase 2 Validation
./scripts/run_basic_validation.sh 2

# Shepherding Taskï¼ˆPhase 2ã®ä»£è¡¨çš„å¿œç”¨ï¼‰
EPH_N_AGENTS=15 \
EPH_SIM_TIME=200 \
EPH_WORLD_SIZE=500 \
EPH_HAZE_DECAY=0.99 \
EPH_HAZE_DEPOSIT=0.2 \
  ./scripts/run_shepherding_experiment.sh
```

---

## Phase 3: Advanced Integration

### ğŸ¯ ç›®çš„
**Phase 2ã®é«˜åº¦ãªçµ±åˆæ©Ÿèƒ½**ã‚’å®Ÿè£…ã—ã€GRUäºˆæ¸¬å™¨ã¨Shepherdingå¿œç”¨ã‚’çµ„ã¿åˆã‚ã›ãŸæœ€å…ˆç«¯ã®ç¾¤çŸ¥èƒ½ã‚’å®Ÿç¾ã™ã‚‹ã€‚

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
Phase 3ã¯æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’è¿½åŠ ã™ã‚‹ã®ã§ã¯ãªãã€**Phase 2ã®å…¨æ©Ÿèƒ½ + è¿½åŠ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**ã§æ§‹æˆã•ã‚Œã¾ã™ï¼š
```julia
# Phase 2ã®ã™ã¹ã¦ + ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
- SPMPredictor: å°†æ¥ã®SPMã‚’äºˆæ¸¬
  - LinearPredictor: é‹å‹•å­¦çš„ãƒ¢ãƒ‡ãƒ«
  - NeuralPredictor: GRUãƒ™ãƒ¼ã‚¹ã®å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«
- ShepherdingEPH: çŠ¬ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åˆ¶å¾¡
- BoidsAgent: ç¾Šã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç¾¤ã‚Œè¡Œå‹•
```

### ğŸ”¬ å‹•ä½œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

#### 1. GRUäºˆæ¸¬å™¨ï¼ˆSPMPredictorï¼‰
```julia
# éå»ã®SPMã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‹ã‚‰å°†æ¥ã®SPMã‚’äºˆæ¸¬
predictor = load_predictor("models/spm_predictor.jld2")
spm_predicted = predict_spm(predictor, agent, env)

# äºˆæ¸¬ã‚’è¡Œå‹•é¸æŠã«çµ±åˆ
cost = F_percept(spm_current) + Î»_pred * F_percept(spm_predicted)
```

**äºˆæ¸¬å™¨ã®ç¨®é¡ï¼š**
- **LinearPredictor**: é‹å‹•å­¦ãƒ¢ãƒ‡ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆdt, velocityï¼‰
- **NeuralPredictor**: GRU + Dense layersï¼ˆå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è¨“ç·´ï¼‰

#### 2. Shepherdingçµ±åˆ
```julia
# çŠ¬ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆEPHåˆ¶å¾¡ï¼‰ã¨ç¾Šã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆBoidsåˆ¶å¾¡ï¼‰ã®å”èª¿
controller = ShepherdingController(eph_params, shep_params)

# Shepherdingç”¨ã®ãƒ¡ã‚¿ã‚³ã‚¹ãƒˆ
M_meta = w_targetÂ·C_target + w_densityÂ·C_density + w_workÂ·C_work

where:
  C_target   = ç¾Šã®é‡å¿ƒã‹ã‚‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¾ã§ã®è·é›¢
  C_density  = ç¾Šã®åˆ†æ•£åº¦ï¼ˆå‡é›†æ€§ã®é€†ï¼‰
  C_work     = çŠ¬ã®ç§»å‹•ã‚³ã‚¹ãƒˆ
```

#### 3. Boidsãƒ«ãƒ¼ãƒ«ï¼ˆç¾Šã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰
```julia
# ç¾Šã¯3ã¤ã®Boidsãƒ«ãƒ¼ãƒ«ã«å¾“ã†
velocity = w_sepÂ·separation + w_alignÂ·alignment + w_cohÂ·cohesion

# ã•ã‚‰ã«çŠ¬ã‹ã‚‰ã®åç™ºã‚’è¿½åŠ 
velocity += dog_repulsion(distance_to_dogs)
```

### âœ… é•·æ‰€
- **äºˆæ¸¬èƒ½åŠ›**ï¼šGRUã«ã‚ˆã‚Šå°†æ¥ã®çŠ¶æ…‹ã‚’äºˆæ¸¬ã—ã€å…ˆèª­ã¿è¡Œå‹•
- **ã‚¿ã‚¹ã‚¯ç‰¹åŒ–**ï¼šShepherdingã®ã‚ˆã†ãªè¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã«å¯¾å¿œ
- **ç•°ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå”èª¿**ï¼šEPHï¼ˆçŠ¬ï¼‰ã¨Boidsï¼ˆç¾Šï¼‰ã®çµ±åˆ
- **å­¦ç¿’å¯èƒ½**ï¼šGRUãƒ¢ãƒ‡ãƒ«ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã§æ”¹å–„å¯èƒ½
- **è«–æ–‡ä¾¡å€¤é«˜**ï¼šæœ€å…ˆç«¯ã®ç ”ç©¶æˆæœã¨ã—ã¦ç™ºè¡¨å¯èƒ½

### âŒ çŸ­æ‰€
- **å®Ÿè£…ãŒæœ€ã‚‚è¤‡é›‘**ï¼šè¤‡æ•°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ±åˆãŒå¿…è¦
- **å­¦ç¿’ãƒ‡ãƒ¼ã‚¿å¿…é ˆ**ï¼šGRUè¨“ç·´ã«å¤§é‡ã®SPMãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦
- **è¨ˆç®—ã‚³ã‚¹ãƒˆæœ€å¤§**ï¼šäºˆæ¸¬å™¨ã®æ¨è«–ã‚³ã‚¹ãƒˆãŒè¿½åŠ 
- **ãƒ‡ãƒãƒƒã‚°å›°é›£**ï¼šå¤šå±¤çš„ãªã‚·ã‚¹ãƒ†ãƒ ã§ã‚¨ãƒ©ãƒ¼åŸå› ã®ç‰¹å®šãŒé›£ã—ã„
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ãŒè¤‡é›‘**ï¼šeph_params, shep_params, GRU hyperparameters

### ğŸ“ˆ è©•ä¾¡æŒ‡æ¨™
- **äºˆæ¸¬ç²¾åº¦**ï¼šGRUäºˆæ¸¬ vs å®Ÿéš›ã®SPMã®å¹³å‡çµ¶å¯¾èª¤å·®ï¼ˆMAEï¼‰
- **Shepherdingæ€§èƒ½**ï¼š
  - Recovery Time: é€ƒèµ°å¾Œã®åæŸæ™‚é–“
  - Path Smoothness: çµŒè·¯ã®Jerkï¼ˆåŠ åŠ é€Ÿåº¦ï¼‰
  - Final Distance: æœ€çµ‚çš„ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‹ã‚‰ã®è·é›¢
- **å­¦ç¿’åŠ¹ç‡**ï¼šè¨“ç·´ãƒ‡ãƒ¼ã‚¿é‡ vs äºˆæ¸¬ç²¾åº¦ã®æ”¹å–„æ›²ç·š
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§èƒ½**ï¼šæ¨è«–æ™‚é–“ï¼ˆGRU forward passï¼‰

### ğŸ§ª å…¸å‹çš„ãªå®Ÿé¨“
```bash
# Phase 3 Validationï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆãƒ†ã‚¹ãƒˆï¼‰
./scripts/run_basic_validation.sh 3

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# âœ… SPMPredictor module import
# âœ… LinearPredictor instantiation
# âœ… ShepherdingEPH module import
# âœ… ShepherdingParams instantiation
# âœ… BoidsAgent module import
# âœ… GRU model loading (optional)

# Shepherding Experimentï¼ˆPhase 3ã®å¿œç”¨ï¼‰
EPH_N_AGENTS=15 \
EPH_SIM_TIME=200 \
EPH_WORLD_SIZE=500 \
  ./scripts/run_shepherding_experiment.sh

# GRUäºˆæ¸¬å™¨ã®è¨“ç·´ï¼ˆãƒ‡ãƒ¼ã‚¿åé›† â†’ å­¦ç¿’ï¼‰
./scripts/gru/update_gru.sh
```

### ğŸ”§ é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```
1. Phase 2ãŒå®Œå…¨ã«å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
   â†“
2. SPMãƒ‡ãƒ¼ã‚¿ã‚’åé›†ï¼ˆEPHå®Ÿé¨“ã‚’å®Ÿè¡Œï¼‰
   â†“
3. GRUãƒ¢ãƒ‡ãƒ«ã‚’è¨“ç·´ï¼ˆupdate_gru.shï¼‰
   â†“
4. Phase 3 Validationã‚’å®Ÿè¡Œ
   â†“
5. Shepherdingå®Ÿé¨“ã§End-to-Endãƒ†ã‚¹ãƒˆ
   â†“
6. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–ï¼ˆeph_params, shep_paramsï¼‰
```

---

## Phase 4: Full 3D Tensor Haze

### ğŸ¯ ç›®çš„
**ãƒãƒ£ãƒãƒ«æ¯ã®ç²¾åº¦åˆ¶å¾¡**ã«ã‚ˆã‚‹é«˜åº¦ãªèªçŸ¥çš„ãƒã‚¤ã‚¢ã‚¹ã¨é¸æŠçš„æ³¨æ„æ©Ÿæ§‹ã‚’å®Ÿç¾ã™ã‚‹ã€‚

ã€Œéšœå®³ç‰©ã¯è¦‹ãˆã‚‹ãŒç„¡è¦–ã™ã‚‹ã€ã€Œé€Ÿåº¦æƒ…å ±ã®ã¿ã‚’é‡è¦–ã™ã‚‹ã€ã¨ã„ã£ãŸã€äººé–“ã®é¸æŠçš„æ³¨æ„ã«ä¼¼ãŸæŸ”è»ŸãªèªçŸ¥åˆ¶å¾¡ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

Phase 4ã¯ **3æ¬¡å…ƒãƒ˜ã‚¤ã‚ºãƒ†ãƒ³ã‚½ãƒ« H(r, Î¸, c)** ã‚’å°å…¥ã—ã¾ã™ï¼š

```julia
# Haze Tensor: H(r, Î¸, c) âˆˆ [0,1]^(Nr Ã— NÎ¸ Ã— Nc)
haze_tensor::Array{Float64, 3}  # (3, Nr, NÎ¸)

# Channel indices:
# c=1: Occupancy channel (å æœ‰)
# c=2: Radial velocity channel (æ”¾å°„é€Ÿåº¦)
# c=3: Tangential velocity channel (æ¥ç·šé€Ÿåº¦)
```

å„ãƒãƒ£ãƒãƒ«ã¯ç‹¬ç«‹ã—ãŸãƒ˜ã‚¤ã‚ºå€¤ã‚’æŒã¡ã€ç•°ãªã‚‹ç²¾åº¦åˆ¶å¾¡ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

### ğŸ”¬ å‹•ä½œãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

#### 1. Per-Channel Haze Computation

å„ãƒãƒ£ãƒãƒ«ã§ç‹¬ç«‹ã—ã¦ãƒ˜ã‚¤ã‚ºã‚’è¨ˆç®—ï¼š

```julia
# Occupancy channel haze
Î©_occ = sum(spm[1, :, :])
h_occ = sigmoid(Î±_occ * (Î©_occ - Î©_threshold_occ)) * w_occupancy

# Radial velocity channel haze
Î©_rad = sum(abs.(spm[2, :, :]))
h_rad = sigmoid(Î±_rad * (Î©_rad - Î©_threshold_rad)) * w_radial_vel

# Tangential velocity channel haze
Î©_tan = sum(abs.(spm[3, :, :]))
h_tan = sigmoid(Î±_tan * (Î©_tan - Î©_threshold_tan)) * w_tangential_vel
```

#### 2. Per-Channel Precision Modulation

å„ãƒãƒ£ãƒãƒ«ã®ç²¾åº¦ã‚’ç‹¬ç«‹ã—ã¦åˆ¶å¾¡ï¼š

```julia
# Precision modulation formula
Î _c(r, Î¸) = (1 - h_c(r, Î¸))^Î³

# Where:
# - h_c(r, Î¸): Haze value for channel c at position (r, Î¸)
# - Î³: Precision modulation exponent (default: 2.0)
# - Î _c: Resulting precision weight for channel c
```

#### 3. Channel Masking (Selective Attention)

ãƒãƒ£ãƒãƒ«ãƒã‚¹ã‚¯ã«ã‚ˆã‚Šé¸æŠçš„æ³¨æ„ã‚’å®Ÿç¾ï¼š

```julia
# Example 1: Ignore obstacles, focus on velocity
channel_mask = [0.0, 1.0, 1.0]  # [occ, rad_vel, tan_vel]
masked_haze = apply_channel_mask(haze_tensor, channel_mask)

# Example 2: Only focus on obstacles
channel_mask = [1.0, 0.0, 0.0]
masked_haze = apply_channel_mask(haze_tensor, channel_mask)
```

#### 4. Weighted Surprise & Entropy

ãƒãƒ£ãƒãƒ«æ¯ã®é‡ã¿ä»˜ãé©šãï¼ˆSurpriseï¼‰ã¨ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ï¼š

```julia
# Weighted surprise (precision-weighted prediction error)
surprise = Î£_c Î£_r Î£_Î¸ w_c * Î _c(r,Î¸) * (spm_current[c,r,Î¸] - spm_previous[c,r,Î¸])Â²

# Weighted entropy (belief uncertainty)
entropy = -Î£_c Î£_r Î£_Î¸ w_c * log(Î _c(r,Î¸))
```

### ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

```
src_julia/control/FullTensorHaze.jl    # Phase 4 core implementation
```

### ğŸ§ª Phase 4 Validation Tests

```bash
# Phase 4æ¤œè¨¼å®Ÿè¡Œ
./scripts/run_basic_validation.sh 4
```

**æ¤œè¨¼é …ç›®:**
1. FullTensorHaze module import
2. FullTensorHazeParams instantiation
3. Full tensor haze computation (3D)
4. Per-channel precision computation
5. Channel mask application
6. Weighted surprise computation

### ğŸ’¡ ä½¿ç”¨ä¾‹

#### ä¾‹1: ã€Œéšœå®³ç‰©ã¯è¦‹ãˆã‚‹ãŒç„¡è¦–ã™ã‚‹ã€è¡Œå‹•

```julia
using .FullTensorHaze

# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š: å æœ‰ãƒãƒ£ãƒãƒ«ã®ãƒ˜ã‚¤ã‚ºã‚’å¢—ã‚„ã™
params = FullTensorHazeParams(
    w_occupancy = 2.0,      # å æœ‰ãƒãƒ£ãƒãƒ«ã‚’å¼·ãæŠ‘åˆ¶
    w_radial_vel = 0.5,
    w_tangential_vel = 0.5,
    h_max_occ = 0.9         # å æœ‰æƒ…å ±ã‚’ã»ã¼ç„¡è¦–
)

# ãƒ˜ã‚¤ã‚ºè¨ˆç®—
haze_tensor = compute_full_tensor_haze(spm, params)
precision_tensor = compute_channel_precision(spm, haze_tensor, params)

# â†’ çµæœ: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯éšœå®³ç‰©ã‚’çŸ¥è¦šã—ã¦ã„ã‚‹ãŒã€
#          ç²¾åº¦ãŒä½ã„ãŸã‚å„ªå…ˆåº¦ã‚’ä¸‹ã’ã¦è¡Œå‹•
```

#### ä¾‹2: é€Ÿåº¦æƒ…å ±ã®ã¿ã«é›†ä¸­

```julia
# ãƒãƒ£ãƒãƒ«ãƒã‚¹ã‚¯ã§å æœ‰æƒ…å ±ã‚’å®Œå…¨ã«é®æ–­
channel_mask = [0.0, 1.0, 1.0]  # å æœ‰OFF, é€Ÿåº¦ON
masked_haze = apply_channel_mask(haze_tensor, channel_mask)

# â†’ çµæœ: é€Ÿåº¦æƒ…å ±ã®ã¿ã‚’ä½¿ã£ãŸè¡Œå‹•æ±ºå®š
```

### ğŸ”§ Phase 4 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

`FullTensorHazeParams` ã§åˆ¶å¾¡å¯èƒ½ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|----------|
| `w_occupancy` | å æœ‰ãƒãƒ£ãƒãƒ«ã®é‡ã¿ | 1.0 |
| `w_radial_vel` | æ”¾å°„é€Ÿåº¦ãƒãƒ£ãƒãƒ«ã®é‡ã¿ | 0.5 |
| `w_tangential_vel` | æ¥ç·šé€Ÿåº¦ãƒãƒ£ãƒãƒ«ã®é‡ã¿ | 0.5 |
| `Î©_threshold_occ` | å æœ‰ãƒãƒ£ãƒãƒ«ã®é–¾å€¤ | 0.05 |
| `Î©_threshold_rad` | æ”¾å°„é€Ÿåº¦ãƒãƒ£ãƒãƒ«ã®é–¾å€¤ | 0.03 |
| `Î©_threshold_tan` | æ¥ç·šé€Ÿåº¦ãƒãƒ£ãƒãƒ«ã®é–¾å€¤ | 0.03 |
| `Î±_occ` | å æœ‰ãƒãƒ£ãƒãƒ«ã®æ„Ÿåº¦ | 10.0 |
| `Î±_rad` | æ”¾å°„é€Ÿåº¦ãƒãƒ£ãƒãƒ«ã®æ„Ÿåº¦ | 8.0 |
| `Î±_tan` | æ¥ç·šé€Ÿåº¦ãƒãƒ£ãƒãƒ«ã®æ„Ÿåº¦ | 8.0 |
| `h_max_occ` | å æœ‰ãƒãƒ£ãƒãƒ«ã®æœ€å¤§ãƒ˜ã‚¤ã‚º | 0.8 |
| `h_max_rad` | æ”¾å°„é€Ÿåº¦ãƒãƒ£ãƒãƒ«ã®æœ€å¤§ãƒ˜ã‚¤ã‚º | 0.6 |
| `h_max_tan` | æ¥ç·šé€Ÿåº¦ãƒãƒ£ãƒãƒ«ã®æœ€å¤§ãƒ˜ã‚¤ã‚º | 0.6 |
| `Î³` | ç²¾åº¦æ¸›è¡°æŒ‡æ•° | 2.0 |

### ğŸš€ Phase 4 ä½¿ç”¨ã‚·ãƒŠãƒªã‚ª

1. **é¸æŠçš„æ³¨æ„ã‚¿ã‚¹ã‚¯**: ç‰¹å®šã®æƒ…å ±æºã®ã¿ã«æ³¨ç›®ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
2. **èªçŸ¥ãƒã‚¤ã‚¢ã‚¹å®Ÿé¨“**: äººé–“ã®èªçŸ¥ãƒã‚¤ã‚¢ã‚¹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
3. **é«˜åº¦ãªç¾¤ã‚Œåˆ¶å¾¡**: ãƒãƒ£ãƒãƒ«æ¯ã®å„ªå…ˆåº¦ã‚’å‹•çš„ã«å¤‰æ›´
4. **ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«çµ±åˆ**: ç•°ãªã‚‹æ„Ÿè¦šæƒ…å ±ã®çµ±åˆæˆ¦ç•¥

### ğŸ”¬ Phase 4 ã®ç†è«–çš„ä½ç½®ã¥ã‘

Phase 4ã¯ **Predictive Coding** ã¨ **Active Inference** ã®çµ±åˆã‚’æœ€ã‚‚é«˜åº¦ã«å®Ÿç¾ï¼š

- **Precision-weighted prediction error minimization** ã®ç›´æ¥å®Ÿè£…
- **Selective attention** ã®ç”Ÿç‰©å­¦çš„å¦¥å½“æ€§
- **Hierarchical inference** ã¸ã®æ‹¡å¼µå¯èƒ½æ€§

---

## æ¯”è¼ƒè¡¨

| é …ç›® | Phase 1: Self-Haze | Phase 2: Environmental Haze | Phase 3: Advanced Integration | Phase 4: Full 3D Tensor Haze |
|------|---------------------|----------------------------|-------------------------------|------------------------------|
| **ãƒ‡ãƒ¼ã‚¿æ§‹é€ ** | ã‚¹ã‚«ãƒ©ãƒ¼å€¤ï¼ˆ1å€¤ï¼‰ | 2Dã‚°ãƒªãƒƒãƒ‰ï¼ˆwidthÃ—heightï¼‰ | Phase 2 + GRU + Shepherding | 3Dãƒ†ãƒ³ã‚½ãƒ«ï¼ˆ3 Ã— Nr Ã— NÎ¸ï¼‰ |
| **ãƒ˜ã‚¤ã‚ºæ‰€åœ¨** | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå†…éƒ¨ | ç’°å¢ƒç©ºé–“ | ç’°å¢ƒç©ºé–“ + äºˆæ¸¬ | SPMç©ºé–“ï¼ˆãƒãƒ£ãƒãƒ«æ¯ï¼‰ |
| **è¨ˆç®—é‡** | O(1) per agent | O(N_grid + N_agents) | O(N_grid + N_agents + GRU) | O(Nr Ã— NÎ¸ Ã— Nc) per agent |
| **ãƒ¡ãƒ¢ãƒª** | ~8 bytes per agent | ~(widthÃ—height) Ã— 8 bytes | Phase 2 + GRUãƒ¢ãƒ‡ãƒ«ï¼ˆ~1MBï¼‰ | ~(NrÃ—NÎ¸Ã—3) Ã— 8 bytes per agent |
| **é€šä¿¡èƒ½åŠ›** | ãªã— | ã‚¹ãƒ†ã‚£ã‚°ãƒãƒ¼ã‚¸ãƒ¼ï¼ˆé–“æ¥ï¼‰ | ã‚¹ãƒ†ã‚£ã‚°ãƒãƒ¼ã‚¸ãƒ¼ + äºˆæ¸¬ | ãƒãƒ£ãƒãƒ«é¸æŠçš„é€šä¿¡ |
| **ç©ºé–“æƒ…å ±** | ãªã— | ã‚ã‚Šï¼ˆæ–¹å‘ãƒ»è·é›¢ä¾å­˜ï¼‰ | ã‚ã‚Š + å°†æ¥äºˆæ¸¬ | ã‚ã‚Šï¼ˆãƒãƒ£ãƒãƒ«æ¯ç‹¬ç«‹ï¼‰ |
| **æ™‚é–“æƒ…å ±** | å³æ™‚ã®ã¿ | å±¥æ­´ï¼ˆæ¸›è¡°ä»˜ãï¼‰ | å±¥æ­´ + å°†æ¥äºˆæ¸¬ | å³æ™‚ï¼ˆãƒãƒ£ãƒãƒ«æ¯ï¼‰ |
| **äºˆæ¸¬å¯èƒ½æ€§** | ä¸å¯ | å¯ï¼ˆGRUç­‰ï¼‰ | GRUã«ã‚ˆã‚‹é«˜ç²¾åº¦äºˆæ¸¬ | ä¸å¯ï¼ˆPhase 3ã¨çµ±åˆå¯ï¼‰ |
| **ç²¾åº¦åˆ¶å¾¡** | ãªã— | ä¸€å¾‹ | ä¸€å¾‹ | ãƒãƒ£ãƒãƒ«æ¯ç‹¬ç«‹åˆ¶å¾¡ |
| **é¸æŠçš„æ³¨æ„** | ãªã— | ãªã— | ãªã— | ãƒãƒ£ãƒãƒ«ãƒã‚¹ã‚¯ã«ã‚ˆã‚‹å®Ÿç¾ |
| **ç†è«–çš„åŸºç›¤** | Active Inference | Active Inference + Stigmergy | Active Inference + Predictive Coding | Precision-weighted Active Inference |
| **å®Ÿè£…é›£æ˜“åº¦** | â­ ç°¡å˜ | â­â­â­ é›£ã—ã„ | â­â­â­â­â­ æœ€é›£é–¢ | â­â­â­â­ é›£ã—ã„ |
| **ãƒ‡ãƒãƒƒã‚°é›£æ˜“åº¦** | â­ ç°¡å˜ | â­â­â­ é›£ã—ã„ | â­â­â­â­â­ éå¸¸ã«é›£ã—ã„ | â­â­â­â­ é›£ã—ã„ |
| **é©ç”¨ã‚¿ã‚¹ã‚¯** | å›é¿ã€æ¢ç´¢ | Shepherdingã€çµŒè·¯è¨ˆç”»ã€ç¾¤ã‚Œè¡Œå‹• | é«˜åº¦ãªShepherdingã€å­¦ç¿’ãƒ™ãƒ¼ã‚¹åˆ¶å¾¡ | é¸æŠçš„æ³¨æ„ã€èªçŸ¥ãƒã‚¤ã‚¢ã‚¹å®Ÿé¨“ |

---

## ã©ã¡ã‚‰ã‚’ä½¿ã†ã¹ãã‹

### Phase 1ã‚’é¸ã¶ã¹ãå ´åˆï¼š
âœ… EPHã®åŸºæœ¬æ¦‚å¿µã‚’ç†è§£ã—ãŸã„
âœ… ã‚·ãƒ³ãƒ—ãƒ«ãªå›é¿ãƒ»æ¢ç´¢è¡Œå‹•ã‚’æ¤œè¨¼ã—ãŸã„
âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§èƒ½ãŒå¿…è¦
âœ… å¤šæ•°ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆ100+ï¼‰ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
âœ… Active Inferenceã®åŸºç¤ã‚’å­¦ã³ãŸã„

### Phase 2ã‚’é¸ã¶ã¹ãå ´åˆï¼š
âœ… é«˜åº¦ãªç¾¤çŸ¥èƒ½ã‚’ç ”ç©¶ã—ãŸã„
âœ… ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®æš—é»™çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦
âœ… Shepherdingã‚¿ã‚¹ã‚¯ã‚’å®Ÿè£…ã—ãŸã„
âœ… çµŒè·¯è¨ˆç”»ãƒ»æœ€é©åŒ–ãŒé‡è¦
âœ… è«–æ–‡ã®ãƒ¡ã‚¤ãƒ³è²¢çŒ®ã¨ã—ã¦è¤‡é›‘ãªã‚·ã‚¹ãƒ†ãƒ ã‚’æç¤ºã—ãŸã„

### Phase 3ã‚’é¸ã¶ã¹ãå ´åˆï¼š
âœ… æœ€å…ˆç«¯ã®äºˆæ¸¬ãƒ™ãƒ¼ã‚¹åˆ¶å¾¡ã‚’ç ”ç©¶ã—ãŸã„
âœ… GRU/LSTMãªã©ã®æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’çµ±åˆã—ãŸã„
âœ… Shepherdingã®ã‚ˆã†ãªè¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã§æœ€é«˜æ€§èƒ½ã‚’ç›®æŒ‡ã™
âœ… ç•°ç¨®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆEPH + Boidsï¼‰ã®å”èª¿ã‚’ç ”ç©¶ã—ãŸã„
âœ… å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒååˆ†ã«ã‚ã‚‹ï¼ˆã¾ãŸã¯åé›†å¯èƒ½ï¼‰
âœ… ãƒˆãƒƒãƒ—å›½éš›ä¼šè­°ãƒ»ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã¸ã®æŠ•ç¨¿ã‚’ç›®æŒ‡ã™

### Phase 4ã‚’é¸ã¶ã¹ãå ´åˆï¼š
âœ… é¸æŠçš„æ³¨æ„ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ç ”ç©¶ã—ãŸã„
âœ… ãƒãƒ£ãƒãƒ«æ¯ã«ç•°ãªã‚‹ç²¾åº¦åˆ¶å¾¡ãŒå¿…è¦
âœ… ã€Œè¦‹ãˆã¦ã„ã‚‹ãŒç„¡è¦–ã™ã‚‹ã€ã‚ˆã†ãªèªçŸ¥ãƒã‚¤ã‚¢ã‚¹ã‚’å®Ÿè£…ã—ãŸã„
âœ… ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«çŸ¥è¦šçµ±åˆã‚’ç ”ç©¶ã—ãŸã„
âœ… äººé–“ã®èªçŸ¥ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ãƒ¢ãƒ‡ãƒ«åŒ–ã—ãŸã„
âœ… Precision-weighted Active Inferenceã®ç†è«–ç ”ç©¶
âœ… Phase 2/3ã®æ‹¡å¼µã¨ã—ã¦ã€ã‚ˆã‚Šé«˜åº¦ãªåˆ¶å¾¡ã‚’ç›®æŒ‡ã™

### æ¨å¥¨é–‹ç™ºãƒ•ãƒ­ãƒ¼ï¼š
```
1. Phase 1ã§åŸºæœ¬å‹•ä½œã‚’æ¤œè¨¼
   â†“
2. Phase 1ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–
   â†“
3. Phase 2ã¸æ‹¡å¼µ
   â†“
4. Phase 2ã®ã‚¹ãƒ†ã‚£ã‚°ãƒãƒ¼ã‚¸ãƒ¼åŠ¹æœã‚’æ¤œè¨¼
   â†“
5. Phase 3 or Phase 4 ã¸åˆ†å²:

   ã€Phase 3ã¸ã€‘           ã€Phase 4ã¸ã€‘
   - SPMãƒ‡ãƒ¼ã‚¿åé›†         - Phase 2ãŒå®‰å®šå‹•ä½œ
   - GRUäºˆæ¸¬å™¨è¨“ç·´         - Phase 4 Validationå®Ÿè¡Œ
   - Shepherdingå®Ÿé¨“       - ãƒãƒ£ãƒãƒ«ãƒã‚¹ã‚¯å®Ÿé¨“
                          - é¸æŠçš„æ³¨æ„ã‚¿ã‚¹ã‚¯
```

---

## è©•ä¾¡æ–¹æ³•

### Phase 1ã®è©•ä¾¡å®Ÿé¨“
```bash
# 1. åŸºæœ¬å‹•ä½œç¢ºèªï¼ˆValidationï¼‰
./scripts/run_basic_validation.sh 1

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# âœ… SelfHaze module loads
# âœ… Self-haze computation works
# âœ… h_self âˆˆ [0, h_max]

# 2. æ¢ç´¢åŠ¹ç‡å®Ÿé¨“
EPH_N_AGENTS=10 EPH_SIM_TIME=300 julia phase1_foraging.jl

# è©•ä¾¡æŒ‡æ¨™:
# - ç©ºé–“ã‚«ãƒãƒ¼ç‡ï¼ˆè¨ªå•ã—ãŸã‚»ãƒ«ã®å‰²åˆï¼‰
# - æ¢ç´¢æ™‚é–“ï¼ˆå…¨é ˜åŸŸã®90%ã‚’è¨ªå•ã™ã‚‹ã¾ã§ã®æ™‚é–“ï¼‰
# - ãƒ˜ã‚¤ã‚ºé·ç§»é »åº¦ï¼ˆisolated â†” crowdedï¼‰
```

### Phase 2ã®è©•ä¾¡å®Ÿé¨“
```bash
# 1. åŸºæœ¬å‹•ä½œç¢ºèªï¼ˆValidationï¼‰
./scripts/run_basic_validation.sh 2

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# âœ… EnvironmentalHaze module loads
# âœ… Haze deposition works
# âœ… Haze sampling from grid works

# 3. ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¯”è¼ƒ
julia scripts/baseline_comparison.jl

# æ¯”è¼ƒå¯¾è±¡:
# - Random: ãƒ©ãƒ³ãƒ€ãƒ ãªè¡Œå‹•é¸æŠ
# - Pure Gradient: å‹¾é…ã®ã¿ï¼ˆãƒ˜ã‚¤ã‚ºãªã—ï¼‰
# - EPH Phase 1: Scalar Self-Haze
# - EPH Phase 2: Environmental Haze
```

### Phase 3ã®è©•ä¾¡å®Ÿé¨“
```bash
# 1. åŸºæœ¬å‹•ä½œç¢ºèªï¼ˆValidationï¼‰
./scripts/run_basic_validation.sh 3

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# âœ… SPMPredictor module import
# âœ… LinearPredictor instantiation
# âœ… ShepherdingEPH module import
# âœ… ShepherdingParams instantiation
# âœ… BoidsAgent module import
# âœ… GRU model loading (optional)

# 2. Shepherdingæ€§èƒ½è©•ä¾¡ï¼ˆPhase 3ã®ä»£è¡¨çš„å¿œç”¨ï¼‰
./scripts/run_shepherding_experiment.sh

# è©•ä¾¡æŒ‡æ¨™:
# - Recovery Timeï¼ˆé€ƒèµ°å¾Œã€ç›®æ¨™ã«æˆ»ã‚‹ã¾ã§ã®æ™‚é–“ï¼‰
# - Path Smoothnessï¼ˆçµŒè·¯ã®Jerkç·å’Œï¼‰
# - Final Distanceï¼ˆæœ€çµ‚çš„ãªç›®æ¨™ã‹ã‚‰ã®è·é›¢ï¼‰
# - Haze distributionï¼ˆãƒ˜ã‚¤ã‚ºã®ç©ºé–“åˆ†å¸ƒï¼‰

# 3. GRUäºˆæ¸¬ç²¾åº¦è©•ä¾¡
# SPMäºˆæ¸¬èª¤å·®ã‚’å¯è¦–åŒ–
julia scripts/evaluate_gru_prediction.jl
```

### Phase 4ã®è©•ä¾¡å®Ÿé¨“
```bash
# 1. åŸºæœ¬å‹•ä½œç¢ºèªï¼ˆValidationï¼‰
./scripts/run_basic_validation.sh 4

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# âœ… FullTensorHaze module import
# âœ… FullTensorHazeParams instantiation
# âœ… Full tensor haze computation (3D)
# âœ… Per-channel precision computation
# âœ… Channel mask application
# âœ… Weighted surprise computation

# 2. ãƒãƒ£ãƒãƒ«é¸æŠçš„æ³¨æ„å®Ÿé¨“
# Phase 4ã®æ ¸å¿ƒæ©Ÿèƒ½ã‚’è©•ä¾¡
julia scripts/phase4_selective_attention_experiment.jl

# è©•ä¾¡æŒ‡æ¨™:
# - ãƒãƒ£ãƒãƒ«ãƒã‚¹ã‚¯ã«ã‚ˆã‚‹è¡Œå‹•å¤‰åŒ–
# - å„ãƒãƒ£ãƒãƒ«ã®ãƒ˜ã‚¤ã‚ºå€¤æ¨ç§»
# - ãƒãƒ£ãƒãƒ«æ¯ã®ç²¾åº¦é‡ã¿ï¼ˆÎ _cï¼‰
# - åŠ é‡ã‚µãƒ—ãƒ©ã‚¤ã‚ºï¼ˆchannel-weighted surpriseï¼‰

# 3. èªçŸ¥ãƒã‚¤ã‚¢ã‚¹å®Ÿé¨“
# ã€Œéšœå®³ç‰©ã¯è¦‹ãˆã‚‹ãŒç„¡è¦–ã™ã‚‹ã€è¡Œå‹•ã®å®šé‡åŒ–
julia scripts/phase4_cognitive_bias_experiment.jl

# è©•ä¾¡æŒ‡æ¨™:
# - éšœå®³ç‰©å›é¿ç‡ï¼ˆãƒãƒ£ãƒãƒ«ãƒã‚¹ã‚¯æœ‰ç„¡æ¯”è¼ƒï¼‰
# - è¡çªæ™‚é–“ (Time-to-Collision)
# - çµŒè·¯åŠ¹ç‡ (Path efficiency)
```

### å¯è¦–åŒ–
```bash
# ãƒ˜ã‚¤ã‚ºã‚°ãƒªãƒƒãƒ‰ã®å¯è¦–åŒ–ï¼ˆPhase 2, 3ï¼‰
python viewer.py  # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–

# çµæœ:
# - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½ç½®ï¼ˆèŒ¶è‰²/ç°è‰²ã®å††ï¼‰
# - ãƒ˜ã‚¤ã‚ºã‚°ãƒªãƒƒãƒ‰ï¼ˆèµ¤è‰²ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰
# - ç§»å‹•è»Œè·¡ï¼ˆãƒ˜ã‚¤ã‚ºã®ç—•è·¡ã¨ã—ã¦æ®‹ã‚‹ï¼‰

# Phase 4: ãƒãƒ£ãƒãƒ«æ¯ãƒ˜ã‚¤ã‚ºã®å¯è¦–åŒ–
# å„ãƒãƒ£ãƒãƒ«ã‚’ç‹¬ç«‹ã—ã¦å¯è¦–åŒ–ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰
# - Channel 1: å æœ‰ãƒ˜ã‚¤ã‚ºï¼ˆèµ¤ï¼‰
# - Channel 2: æ”¾å°„é€Ÿåº¦ãƒ˜ã‚¤ã‚ºï¼ˆç·‘ï¼‰
# - Channel 3: æ¥ç·šé€Ÿåº¦ãƒ˜ã‚¤ã‚ºï¼ˆé’ï¼‰
```

---

## ã¾ã¨ã‚

| | Phase 1 | Phase 2 | Phase 3 | Phase 4 |
|---|---------|---------|---------|---------|
| **ä¸€è¨€ã§è¨€ã†ã¨** | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªèº«ã®ã€Œä¸ç¢ºå®Ÿæ€§ã€ã‚’è¡¨ç¾ | ç’°å¢ƒã‚’é€šã˜ãŸã€Œé–“æ¥çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ | äºˆæ¸¬ãƒ™ãƒ¼ã‚¹ã®ã€Œå…ˆèª­ã¿è¡Œå‹•ã€ | ãƒãƒ£ãƒãƒ«æ¯ã®ã€Œé¸æŠçš„æ³¨æ„ã€ |
| **Active Inferenceã¨ã®é–¢ä¿‚** | ä¿¡å¿µã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã®ç›´æ¥çš„å®Ÿè£… | ã‚¹ãƒ†ã‚£ã‚°ãƒãƒ¼ã‚¸ãƒ¼ + Active Inference | Predictive Coding + Active Inference | Precision-weighted Active Inference |
| **ç”Ÿç‰©å­¦çš„é¡ä¼¼** | å€‹ä½“ã®ã€Œè­¦æˆ’åº¦ã€ | ã‚¢ãƒªã®ã€Œãƒ•ã‚§ãƒ­ãƒ¢ãƒ³ã€ | äººé–“ã®ã€Œäºˆæ¸¬åˆ¶å¾¡ã€ | äººé–“ã®ã€Œé¸æŠçš„æ³¨æ„ã€ |
| **æ¨å¥¨ã•ã‚Œã‚‹ä½¿ç”¨é †åº** | 1ç•ªç›®ï¼ˆåŸºç¤æ¤œè¨¼ï¼‰ | 2ç•ªç›®ï¼ˆå¿œç”¨ç ”ç©¶ï¼‰ | 3ç•ªç›®ï¼ˆæœ€å…ˆç«¯ç ”ç©¶ï¼‰ | 2ç•ªç›®ã®åˆ†å²ï¼ˆPhase 2å¾Œï¼‰ |

**é–‹ç™ºè€…ã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š**
- ã¾ãšPhase 1ã§åŸºæœ¬ã‚’å›ºã‚ã‚‹
- Phase 1ãŒå®‰å®šå‹•ä½œã—ã¦ã‹ã‚‰Phase 2ã¸
- Phase 2ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆdecay_rate, deposit_amountï¼‰ã¯æ…é‡ã«èª¿æ•´
- Phase 2å®‰å®šå¾Œã€Phase 3ï¼ˆäºˆæ¸¬ï¼‰ã¾ãŸã¯Phase 4ï¼ˆé¸æŠçš„æ³¨æ„ï¼‰ã¸åˆ†å²
  - **Phase 3ã¸**: GRUäºˆæ¸¬ãŒå¿…è¦ â†’ SPMãƒ‡ãƒ¼ã‚¿åé›† â†’ GRUè¨“ç·´
  - **Phase 4ã¸**: é¸æŠçš„æ³¨æ„ãŒå¿…è¦ â†’ Phase 4 Validation â†’ ãƒãƒ£ãƒãƒ«ãƒã‚¹ã‚¯å®Ÿé¨“
- Phase 3/4ã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹ãŸã‚ã€ä¸¡æ–¹å®Ÿè£…ã—ã¦æ¯”è¼ƒç ”ç©¶ã‚‚å¯èƒ½
- è«–æ–‡ã§ã¯4ã¤ã®Phaseã‚’æ¯”è¼ƒã™ã‚‹ã“ã¨ã§æ®µéšçš„ãªè²¢çŒ®ã‚’ç¤ºã›ã‚‹

---

## å‚è€ƒæƒ…å ±

### ã‚³ãƒ¼ãƒ‰ä½ç½®
- Phase 1å®Ÿè£…: `src_julia/control/SelfHaze.jl`
- Phase 2å®Ÿè£…: `src_julia/control/EnvironmentalHaze.jl`
- Phase 3å®Ÿè£…:
  - GRUäºˆæ¸¬å™¨: `src_julia/prediction/SPMPredictor.jl`
  - Shepherdingåˆ¶å¾¡: `src_julia/control/ShepherdingEPH.jl`
  - Boidsåˆ¶å¾¡: `src_julia/agents/BoidsAgent.jl`
- Phase 4å®Ÿè£…: `src_julia/control/FullTensorHaze.jl`

### å®Ÿé¨“ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- Phase 1æ¤œè¨¼: `scripts/run_basic_validation.sh 1`
- Phase 2æ¤œè¨¼: `scripts/run_basic_validation.sh 2`
- Phase 3æ¤œè¨¼: `scripts/run_basic_validation.sh 3`
- Phase 4æ¤œè¨¼: `scripts/run_basic_validation.sh 4`
- å…¨Phaseæ¤œè¨¼: `scripts/run_basic_validation.sh all`
- Shepherding: `scripts/run_shepherding_experiment.sh`
- ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¯”è¼ƒ: `scripts/baseline_comparison.jl`
- GRUè¨“ç·´: `scripts/gru/update_gru.sh`

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
```julia
# Phase 1ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆsrc_julia/core/Types.jlï¼‰
EPHParams(
    h_max = 0.8,           # æœ€å¤§ãƒ˜ã‚¤ã‚º
    Î± = 10.0,              # Sigmoidæ€¥å³»åº¦
    Î©_threshold = 0.05,    # å æœ‰ç‡é–¾å€¤
    Î³ = 2.0                # ç²¾åº¦å¤‰èª¿å¼·åº¦
)

# Phase 2è¿½åŠ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
decay_rate = 0.99          # ãƒ˜ã‚¤ã‚ºæ¸›è¡°ç‡
deposit_amount = 0.2       # ãƒ˜ã‚¤ã‚ºå †ç©é‡
```
